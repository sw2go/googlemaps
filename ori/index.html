<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <head>
    <title>SE</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <button onclick="start('manu')">Click me</button>
    <p id="log"></p>
	<p id="lat"></p>
	<p id="lng"></p>
	<p id="compass"></p>
	<p id="alpha"></p>
	<p id="beta"></p>
	<p id="gamma"></p>
	<p id="accx"></p>
	<p id="accy"></p>
	<p id="accz"></p>
	<p id="rotx"></p>
	<p id="roty"></p>
	<p id="rotz"></p>

	
	<script>
		function start(text){
		
			log('start ' + text);
			
			if (navigator.geolocation) {
			  navigator.geolocation.watchPosition((position) => {
				  document.getElementById("lat").innerText = "lat " + position.coords.latitude;
				  document.getElementById("lng").innerText = "lng " + position.coords.longitude;
				},
				() => {
				  document.getElementById("lat").innerText = "lat failed";
				  document.getElementById("lng").innerText = "lng failed";
				}
			  );
			} else {
			  log('no geolocation');
			}
				
			if (typeof DeviceMotionEvent.requestPermission === 'function') {
				
				// for IOS devices
				log('is iOS');
				
				// get device orientation sensor data
				DeviceOrientationEvent.requestPermission().then(response => {
					log('Orientation ' + response);
					if (response === 'granted') {
						window.addEventListener('deviceorientation', OrientationHandler, true);
					}else if (response.state === 'prompt') {
						log("Orientation Need prompt!");
					}else{
						log("Orientation Not Supported!");
					}
				}).catch(console.error)
				
				// get accelerometer data
				DeviceMotionEvent.requestPermission().then(response => {
					if (response === 'granted') {
					    log("Motion granted ");
						window.addEventListener('devicemotion', MotionHandler, true);
					}else if (result.state === 'prompt') {
						log("Motion Need prompt!");
					}else{
						log("Motion Not Supported!");
					}
				}).catch(log('error'))
				
			} else {
				
				// for non ios devices
				log("Not IOS! ");
				
				// get device orientation sensor data
				window.addEventListener('deviceorientationabsolute', OrientationHandler, true);
				// get accelerometer data
				window.addEventListener('devicemotion', MotionHandler, true);
			}

		}
		
		// Handlers for data
		
		function OrientationHandler(eventData){

			if (event.webkitCompassHeading) {
				document.getElementById('compass').innerHTML = "compass " + (360 - event.webkitCompassHeading);
			} else {
				document.getElementById('compass').innerHTML = "absolute " + event.absolute;
			}
		
			// gamma is the left-to-right tilt in degrees
			document.getElementById('gamma').innerHTML = "gamma " + eventData.gamma;

			// beta is the front-to-back tilt in degrees
			document.getElementById('beta').innerHTML = "beta " + eventData.beta;

			// alpha is the compass direction the device is facing in degrees
			document.getElementById('alpha').innerHTML = "alpha " + eventData.alpha;
		}
		
		function MotionHandler(eventData){
			
			// Acceleration
			document.getElementById('accx').innerHTML = "accx " + eventData.acceleration.x;
			document.getElementById('accy').innerHTML = "accy " + eventData.acceleration.y;
			document.getElementById('accz').innerHTML = "accz " + eventData.acceleration.z;

			// Rotation rate
			document.getElementById('rotx').innerHTML = "rotx " + eventData.rotationRate.alpha;
			document.getElementById('roty').innerHTML = "roty " + eventData.rotationRate.beta;
			document.getElementById('rotz').innerHTML = "rotz " + eventData.rotationRate.gamma;
		}
		
		function log(msg) {
			document.getElementById('log').innerText += (" " + msg + " ")
		}
		
		start('auto');
	</script>
  </body>
</html>
